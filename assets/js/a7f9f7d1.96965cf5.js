"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4244],{134:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"website-setup/nextjs-deployment","title":"Next.js Deployment","description":"This guide explains how to deploy your eDemand web application with SEO support using Next.js on a VPS server.","source":"@site/docs/website-setup/nextjs-deployment.md","sourceDirName":"website-setup","slug":"/website-setup/nextjs-deployment","permalink":"/eDemand-Doc/docs/website-setup/nextjs-deployment","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11},"sidebar":"webSidebar","previous":{"title":"Analytics and Advertising Setup","permalink":"/eDemand-Doc/docs/website-setup/analytics-and-ads-setup"},"next":{"title":".htaccess Configuration","permalink":"/eDemand-Doc/docs/website-setup/htaccess-config"}}');var i=s(4848),r=s(8453);const l={sidebar_position:11},o="Next.js Deployment",d={},a=[{value:"Uploading Your Project",id:"uploading-your-project",level:2},{value:"Installing Node.js",id:"installing-nodejs",level:2},{value:"Installing PM2",id:"installing-pm2",level:2},{value:"Automated Deployment (Recommended)",id:"automated-deployment-recommended",level:2},{value:"Manual Deployment",id:"manual-deployment",level:2},{value:"1. Configuration &amp; Dependencies",id:"1-configuration--dependencies",level:4},{value:"2. Generate Assets",id:"2-generate-assets",level:4},{value:"3. Build Application",id:"3-build-application",level:4},{value:"4. Configure Port",id:"4-configure-port",level:4},{value:"5. Generate Apache Configuration",id:"5-generate-apache-configuration",level:4},{value:"6. Start with PM2",id:"6-start-with-pm2",level:4},{value:"7. Finalize Apache",id:"7-finalize-apache",level:4},{value:"Deployment System Details",id:"deployment-system-details",level:2},{value:"Key Features",id:"key-features",level:3},{value:"New Scripts &amp; Files",id:"new-scripts--files",level:3},{value:"Integration Notes for Developers",id:"integration-notes-for-developers",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"nextjs-deployment",children:"Next.js Deployment"})}),"\n",(0,i.jsx)(n.p,{children:"This guide explains how to deploy your eDemand web application with SEO support using Next.js on a VPS server."}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"This is an advanced deployment option for users who have a VPS server and are familiar with Node.js, npm, and pm2. The instructions assume you're using a Debian-based Linux distribution."})}),"\n",(0,i.jsxs)(n.admonition,{title:"Server Compatibility",type:"info",children:[(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"Automated"})," and ",(0,i.jsx)(n.strong,{children:"Manual"})," deployment methods described below are specifically configured for ",(0,i.jsx)(n.strong,{children:"Apache"})," web servers (using ",(0,i.jsx)(n.code,{children:".htaccess"})," for reverse proxy and rewrite rules)."]}),(0,i.jsxs)(n.p,{children:["Different web servers (like Nginx) require different configuration. If you are using a different server environment and encounter issues, please ",(0,i.jsx)(n.strong,{children:"connect with our technical team"}),", and we will surely help you."]})]}),"\n",(0,i.jsx)(n.h2,{id:"uploading-your-project",children:"Uploading Your Project"}),"\n",(0,i.jsx)(n.p,{children:"Before starting deployment, upload your project to the server:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Use an FTP client like ",(0,i.jsx)(n.a,{href:"https://filezilla-project.org/download.php",children:"FileZilla"})," to upload your project files to your server"]}),"\n",(0,i.jsx)(n.li,{children:"Alternatively, use Git to clone your repository directly on the server"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"installing-nodejs",children:"Installing Node.js"}),"\n",(0,i.jsx)(n.p,{children:"Node.js can be installed using NVM (Node Version Manager) to easily manage multiple Node.js versions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt install curl\ncurl https://raw.githubusercontent.com/creationix/nvm/master/install.sh | bash\nsource ~/.bashrc  # or restart your terminal\nnvm install node 20.*\n"})}),"\n",(0,i.jsx)(n.p,{children:"Verify the installation with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"node -v\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For more information, refer to the ",(0,i.jsx)(n.a,{href:"https://nodejs.org/docs/latest/api/",children:"official Node.js documentation"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"installing-pm2",children:"Installing PM2"}),"\n",(0,i.jsx)(n.p,{children:"PM2 is a production process manager for Node.js applications. Install it globally with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install pm2 -g\n"})}),"\n",(0,i.jsx)(n.h2,{id:"automated-deployment-recommended",children:"Automated Deployment (Recommended)"}),"\n",(0,i.jsx)(n.p,{children:"We have implemented a robust, automated deployment workflow designed for Custom Server (VPS) environments. This new system ensures consistent builds, optimized server configurations, and seamless updates."}),"\n",(0,i.jsx)(n.p,{children:"To deploy the application on the VPS using the automated script:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SSH into the server"})," and navigate to the project directory."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Run the deployment script"}),":","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./deploy_vps.sh\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Follow the prompts"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Enter the desired PORT (default: ",(0,i.jsx)(n.code,{children:"8001"}),")."]}),"\n",(0,i.jsx)(n.li,{children:"The script will automatically detect conflicting processes and ask to restart or replace them."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Outcome"}),": The app will be running under PM2 (name: ",(0,i.jsx)(n.code,{children:"edemand-web"}),"), serving locally on the specified port, with Apache handling the public-facing traffic and caching."]}),"\n",(0,i.jsx)(n.h2,{id:"manual-deployment",children:"Manual Deployment"}),"\n",(0,i.jsx)(n.p,{children:"If you prefer to deploy manually or need to troubleshoot, follow these steps to replicate the automated process:"}),"\n",(0,i.jsx)(n.h4,{id:"1-configuration--dependencies",children:"1. Configuration & Dependencies"}),"\n",(0,i.jsxs)(n.p,{children:["Ensure your ",(0,i.jsx)(n.code,{children:".env"})," file is correctly configured (see ",(0,i.jsx)(n.a,{href:"/eDemand-Doc/docs/website-setup/system-configuration",children:"System Configuration"}),")."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Install dependencies\nnpm install\n\n# (Optional) Clean old build artifacts\nrm -rf .next out dist\n"})}),"\n",(0,i.jsx)(n.h4,{id:"2-generate-assets",children:"2. Generate Assets"}),"\n",(0,i.jsx)(n.p,{children:"Run the helper scripts to generate the sitemap and service worker:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Generate Sitemap\nnode scripts/setup-sitemap.js\n\n# Generate Service Worker\nnode scripts/generate-sw.js\n"})}),"\n",(0,i.jsx)(n.h4,{id:"3-build-application",children:"3. Build Application"}),"\n",(0,i.jsx)(n.p,{children:"Build the application in standalone mode. If you require SEO features, set the environment variable."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Build with SEO enabled\nexport NEXT_PUBLIC_ENABLE_SEO="true"\nnpm run build\n'})}),"\n",(0,i.jsx)(n.h4,{id:"4-configure-port",children:"4. Configure Port"}),"\n",(0,i.jsxs)(n.p,{children:["Manually update the port in your ",(0,i.jsx)(n.code,{children:"ecosystem.config.cjs"})," file if you are not using the default ",(0,i.jsx)(n.code,{children:"8001"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// ecosystem.config.cjs\nmodule.exports = {\n  apps: [{\n    // ...\n    env: {\n      NODE_ENV: 'production',\n      PORT: 8001, // Update this value\n    }\n  }]\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"5-generate-apache-configuration",children:"5. Generate Apache Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["Use the included script to generate the correct .htaccess file for your port.\nEnsure ",(0,i.jsx)(n.code,{children:'NEXT_PUBLIC_ENABLE_SEO="true"'})," is set in your environment or ",(0,i.jsx)(n.code,{children:".env"})," file to enable performance caching."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Replace 8001 with your chosen port\nnpm run generate-htaccess -- 8001\n\n"})}),"\n",(0,i.jsx)(n.h4,{id:"6-start-with-pm2",children:"6. Start with PM2"}),"\n",(0,i.jsx)(n.p,{children:"Start or reload the application using PM2."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Start the application\npm2 start ecosystem.config.cjs\n\n# Save the process list to resurrect on reboot\npm2 save\n"})}),"\n",(0,i.jsx)(n.h4,{id:"7-finalize-apache",children:"7. Finalize Apache"}),"\n",(0,i.jsxs)(n.p,{children:["Reload Apache to apply the new ",(0,i.jsx)(n.code,{children:".htaccess"})," rules (ensure ",(0,i.jsx)(n.code,{children:"mod_rewrite"})," and ",(0,i.jsx)(n.code,{children:"mod_headers"})," are valid)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl reload apache2\n"})}),"\n",(0,i.jsx)(n.h2,{id:"deployment-system-details",children:"Deployment System Details"}),"\n",(0,i.jsx)(n.h3,{id:"key-features",children:"Key Features"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Standalone Build Mode"}),": The application is now forced to build in Next.js standalone mode. This produces a lightweight, production-ready Node.js server (",(0,i.jsx)(n.code,{children:"server.js"}),") that minimizes memory usage and removes the need for the entire ",(0,i.jsx)(n.code,{children:"node_modules"})," directory in production."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Automated Deployment Script"}),": A single script (",(0,i.jsx)(n.code,{children:"deploy_vps.sh"}),") handles the end-to-end deployment lifecycle:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Safety Checks"}),": Verifies ports and detects conflicting PM2 processes (e.g., auto-resolving conflicts between ",(0,i.jsx)(n.code,{children:"edemand-web"})," and test instances)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Clean Build"}),": Removes stale artifacts (",(0,i.jsx)(n.code,{children:".next"}),", ",(0,i.jsx)(n.code,{children:"out"}),") to prevent cache inconsistencies."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Asset Generation"}),": Automatically runs scripts to generate the ",(0,i.jsx)(n.code,{children:"sitemap.xml"}),", ",(0,i.jsx)(n.code,{children:"robots.txt"}),", and ",(0,i.jsx)(n.code,{children:"firebase-messaging-sw.js"})," before building."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dynamic Configuration"}),": Updates ",(0,i.jsx)(n.code,{children:"ecosystem.config.cjs"})," with the selected port at runtime."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Smart Apache Configuration"}),": Introduces a dynamic ",(0,i.jsx)(n.code,{children:".htaccess"})," generator (",(0,i.jsx)(n.code,{children:"scripts/generate-htaccess.js"}),") that:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Configures Reverse Proxy rules to route traffic to the Node.js server."}),"\n",(0,i.jsxs)(n.li,{children:["Serves static assets (",(0,i.jsx)(n.code,{children:"/_next/static"}),", public images) directly via Apache for maximum speed."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SEO Mode"}),": When enabled, injects high-performance caching headers (Cache-Control, Expires) to improve Google PageSpeed Insights scores."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"new-scripts--files",children:"New Scripts & Files"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"Script/File"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.code,{children:"deploy_vps.sh"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"Main deployment entry point. Run this on the VPS to deploy. prompts for a PORT and handles the rest."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.code,{children:"scripts/generate-htaccess.js"})}),(0,i.jsxs)(n.td,{style:{textAlign:"left"},children:["Generates the Apache ",(0,i.jsx)(n.code,{children:".htaccess"})," file programmatically based on the active PORT and ",(0,i.jsx)(n.code,{children:"NEXT_PUBLIC_ENABLE_SEO"})," flag."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.code,{children:"package.json"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:'Added "generate-htaccess" command. Updated "build" to use --webpack (disabling Turbopack for compatibility).'})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:(0,i.jsx)(n.code,{children:"next.config.mjs"})}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"Configuration reduced to force output: 'standalone' regardless of environment, ensuring reliability."})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"integration-notes-for-developers",children:"Integration Notes for Developers"}),"\n",(0,i.jsx)(n.admonition,{title:"Important",type:"caution",children:(0,i.jsxs)(n.p,{children:["If you need to change the caching logic or rewrite rules, ",(0,i.jsxs)(n.strong,{children:["do not edit ",(0,i.jsx)(n.code,{children:".htaccess"})," directly"]}),". Instead, modify ",(0,i.jsx)(n.code,{children:"scripts/generate-htaccess.js"}),". The ",(0,i.jsx)(n.code,{children:".htaccess"})," file is regenerated every time ",(0,i.jsx)(n.code,{children:"npm run generate-htaccess"})," or ",(0,i.jsx)(n.code,{children:"./deploy_vps.sh"})," is run, so manual changes will be lost."]})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var t=s(6540);const i={},r=t.createContext(i);function l(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);